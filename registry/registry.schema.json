{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cryptoreference.io/registry/registry.schema.json",

  "title": "CR Metadata Registry Schema (Non-Canonical)",
  "description": "Non-canonical, metadata-only registry schema. This file is NOT authoritative for generation, ingestion, or planning. Canonical registry is /public/dataset/registry.json.",

  "type": "object",

  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },

    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+$",
      "description": "Metadata registry schema version"
    },

    "registry_role": {
      "type": "string",
      "const": "metadata-only",
      "description": "Hard lock: this registry is metadata-only"
    },

    "canonical": {
      "type": "boolean",
      "const": false,
      "description": "This registry is NOT canonical"
    },

    "canonical_source": {
      "type": "string",
      "const": "/public/dataset/registry.json",
      "description": "The ONLY canonical registry source"
    },

    "planning_allowed": {
      "type": "boolean",
      "const": false,
      "description": "Planning is forbidden in this registry"
    },

    "generation_allowed": {
      "type": "boolean",
      "const": false,
      "description": "Page generation is forbidden from this registry"
    },

    "used_for_ai_generation": {
      "type": "boolean",
      "const": false
    },

    "used_for_dataset_ingestion": {
      "type": "boolean",
      "const": false
    },

    "entries": {
      "type": "array",
      "description": "Descriptive registry entries (non-authoritative)",
      "items": {
        "$ref": "#/definitions/RegistryEntry"
      }
    },

    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "Non-authoritative timestamp (informational only)"
    }
  },

  "required": [
    "version",
    "registry_role",
    "canonical",
    "canonical_source",
    "planning_allowed",
    "generation_allowed",
    "used_for_ai_generation",
    "used_for_dataset_ingestion",
    "entries"
  ],

  "additionalProperties": false,

  "definitions": {
    "RegistryEntry": {
      "type": "object",

      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "minLength": 2,
          "maxLength": 100,
          "description": "Stable opaque identifier (non-semantic)"
        },

        "type": {
          "type": "string",
          "enum": [
            "entity",
            "child_entity",
            "education",
            "comparison",
            "interface",
            "metrics"
          ],
          "description": "Descriptive page category (NOT authoritative)"
        },

        "parent_id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Descriptive parent relationship (non-authoritative)"
        },

        "entities": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "minItems": 2,
          "description": "Descriptive comparison participants"
        },

        "cr_required": {
          "type": "boolean",
          "description": "CR requirement hint (NOT enforcement)"
        },

        "page_status": {
          "type": "string",
          "enum": ["missing", "published", "deprecated", "duplicate"],
          "description": "Lifecycle hint (canonical status defined elsewhere)"
        },

        "source_scope": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "official_site",
              "official_docs",
              "product_pages",
              "campaigns",
              "analytics",
              "official_social"
            ]
          },
          "description": "Opaque source hints (NOT authoritative)"
        },

        "canonical_id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Reference to canonical ID (only for duplicate)"
        },

        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Informational timestamp only"
        },

        "published_at": {
          "type": "string",
          "format": "date-time",
          "description": "Informational timestamp only"
        }
      },

      "required": ["id", "type", "page_status", "cr_required", "source_scope"],

      "additionalProperties": false,

      "allOf": [
        {
          "if": {
            "properties": { "type": { "const": "child_entity" } }
          },
          "then": {
            "required": ["parent_id"]
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "entity" } }
          },
          "then": {
            "not": { "required": ["parent_id"] }
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "comparison" } }
          },
          "then": {
            "required": ["entities"]
          }
        },
        {
          "if": {
            "properties": { "page_status": { "const": "duplicate" } }
          },
          "then": {
            "required": ["canonical_id"]
          }
        }
      ]
    }
  }
}