{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cryptoreference.io/registry/registry.schema.json",
  "title": "CR Registry Schema",
  "description": "Schema for the canonical registry - single source of memory for AI-first content generation",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+$",
      "description": "Registry schema version"
    },
    "entries": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/RegistryEntry"
      },
      "description": "Array of registry entries"
    }
  },
  "required": ["version", "entries"],
  "additionalProperties": false,
  "definitions": {
    "RegistryEntry": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "minLength": 2,
          "maxLength": 100,
          "description": "Unique registry ID (lowercase, hyphen-separated)"
        },
        "type": {
          "type": "string",
          "enum": ["entity", "child_entity", "education", "comparison", "interface", "metrics"],
          "description": "Page type determining CR requirements"
        },
        "parent_id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Parent entity ID (required for child_entity, forbidden for others)"
        },
        "entities": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "minItems": 2,
          "description": "Referenced entity IDs (required for comparison)"
        },
        "cr_required": {
          "type": "boolean",
          "description": "Whether CR-Markup is required (true for entity/child_entity, false for others)"
        },
        "page_status": {
          "type": "string",
          "enum": ["missing", "published", "deprecated", "duplicate"],
          "description": "Current page lifecycle status"
        },
        "source_scope": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["official_site", "official_docs", "product_pages", "campaigns", "analytics", "official_social"]
          },
          "description": "Allowed official source scopes for fact extraction"
        },
        "canonical_id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Reference to canonical ID (required when page_status=duplicate)"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of entry creation"
        },
        "published_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of publication"
        }
      },
      "required": ["id", "type", "cr_required", "page_status", "source_scope"],
      "additionalProperties": false,
      "allOf": [
        {
          "if": {
            "properties": { "type": { "const": "child_entity" } }
          },
          "then": {
            "required": ["parent_id"]
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "entity" } }
          },
          "then": {
            "not": { "required": ["parent_id"] }
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "comparison" } }
          },
          "then": {
            "required": ["entities"],
            "not": { "required": ["parent_id"] }
          }
        },
        {
          "if": {
            "properties": { "type": { "enum": ["entity", "child_entity"] } }
          },
          "then": {
            "properties": { "cr_required": { "const": true } }
          }
        },
        {
          "if": {
            "properties": { "type": { "enum": ["education", "comparison", "interface", "metrics"] } }
          },
          "then": {
            "properties": { "cr_required": { "const": false } }
          }
        },
        {
          "if": {
            "properties": { "page_status": { "const": "duplicate" } }
          },
          "then": {
            "required": ["canonical_id"]
          }
        }
      ]
    }
  }
}
